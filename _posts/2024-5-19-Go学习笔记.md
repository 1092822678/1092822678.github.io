---
layout: post
title: "Go学习笔记 - 持续更新"
date:   2024-5-19
tags: [tag1]
comments: true
author: zlchen
---

<!-- more -->

# Golang中`...`用法 / Go函数接受可变参数
* 第一个用法用于函数有多个不确定桉树的情况，可接受任意数量的参数
```
func Sum(vals ...int) int {
    total := 0
    for _, val := range vals {
        total += val
    }
    return total
}
```
* 第二个用法是将Slice打散进行传递, 即当`...`出现在切片后面的时候，表示将切片展开
```
// example 1
nums := []int{1, 2, 3}
fmt.Println(nums...)  // 输出1 2 3

// example 2
func test1(args ...string) { //可以接受任意个string参数
    for _, v:= range args{
        fmt.Println(v)
    }
}

func main(){
var strss= []string{
        "qwr",
        "234",
        "yui",
    }
    test1(strss...) //切片被打散传入
}
// output:
// qwr
// 234
// yui
```

# 并发编程笔记

### 并发控制
#### `Channel`
Channel不仅可以用于协程之间的通信，还可以用于并发控制
#### `Context`
##### 数据结构
```
  type Context interface {
   Deadline() (deadline time.Time, ok bool)
   Done() <-chan struct{}
   Err() error
   Value(key interface{}) interface{}
}
```
##### 如何理解`Context`
从一个具体的使用场景来理解 - 取消Goroutine  
> 在Go 里，我们不能直接杀死协程，协程的关闭一般会用 `channel+select` 方式来控制
```
# 使用一个channel来发送一个信号给协程，告诉它应该退出了。这个channel通常被称为"done" channel，当你想停止一个Goroutine时，你就向这个channel发送一个值。而select语句则可以用来等待多个channel中的一个准备好，然后执行对应的操作。在处理Goroutine退出的情况时，我们通常会在select语句中包含一个case来等待"done" channel的信号

func doWork(done <-chan bool) {
    for {
        select {
        case <-done:
            return
        default:
            // do some work
        }
    }
}

func main() {
    done := make(chan bool)
    go doWork(done)
    // 当你想让Goroutine停止时
    done <- true
}
```
> 在某些场景下，例如处理一个请求衍生了很多协程，这些协程是相互关联的:需要共享一些全局变量、有共同的 deadline 等，而且可以同时被关闭, 再用 channel+select 就会比较麻烦，这时就可以通过 context 来实现

#### 总结
* context更适合于一对多的控制情况，比如一个主Goroutine控制多个子Goroutine，只要主Goroutine的context被取消，所有从这个context派生的子Goroutine都会收到取消信号。而channel通常用于一对一的或者多对多的数据通信
* context是为了解决不同Goroutines之间的数据传递、取消信号传递、超时信号传递等问题而设计的。在父子Goroutine之间传递context，可以方便地控制子Goroutine的生命周期。而channel更多的是用于在Goroutines之间进行数据通信

### 参考资料
[Context是什么](https://golang.design/go-questions/stdlib/context/what/)  
[Context结构原理](https://juejin.cn/post/7029704699435548679?searchId=20240724144704A57F1A20B447933B59AE#heading-14)  
[常见并发模式](https://chai2010.cn/advanced-go-programming-book/ch1-basic/ch1-06-goroutine.html#168-context-%E5%8C%85)  
